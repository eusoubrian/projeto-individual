<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quem é o Cantor?</title>
    <link rel="stylesheet" href="joguinho.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <main>
        <section id="teste-conhecimento">

            <div class="esquerda">
                <div class="titulo-melhores">
                    <h2>QUEM É O CANTOR?</h2>
                </div>
                <div class="caixa-enorme-sorteio">
                    <div class="caixa-sorteio">
                        <h4>Olha o Cantor aqui de novo!</h4>
                        <p>Agora valendo pontuação de verdade! Você tem 10 tentativas</p>
                        <p>Você deverá descobrir quem é o Artista desse álbum <br>
                            Para cada acerto: <span class="span-ouro">+10 pontos</span> <br>
                            Para cada erro: <span class="span-ouro">-5 pontos</span>
                        </p>
                    </div>
                </div>

                <div class="caixa-exibicao">

                    <button onclick="sorteio()">Sortear imagem</button>
                    <button id="botao-verificar" onclick="verificar()">Verificar</button>
                </div>
            </div>

            <div class="direita">
                <div id="divImagem"></div>
                <label for="inputNome">Nome do Artista</label>
                <input id="inputNome" spellcheck="false">
            </div>

        </section>
    </main>
</body>

</html>

<script>
    var listaImagens = [
        {
            imagem: "<img class='img_legal' src='../assets/imgs/albuns/anos70/acabou_chorare_baianos.jpg'>",
            nome: "novos baianos"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos80/ney_matogrosso_apenas.jpg'>",
            nome: "ney matogrosso"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos80/beleleu_assumpcao.jpg'>",
            nome: "itamar assumpção"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos2000/nada_como_um_dia.jpg'>",
            nome: "racionais mc's"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos90/divina_comedia_humana_belchior.jpg'>",
            nome: "belchior"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/estudando_samba_tomze.jpg'>",
            nome: "tom zé"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/danca_solidao_paulinViola.jpg'>",
            nome: "paulinho da viola"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos2000/tamo_atividade_charlie.jpg'>",
            nome: "charlie brown jr"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos2000/sim_vanessa_mata.jpg'>",
            nome: "vanessa da mata"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos80/caminhos_coracao_gonzaguinha.jpg'>",
            nome: "gonzaguinha"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/forca_bruta_jorgeBen.jpg'>",
            nome: "jorge ben jor"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/cantar_gal.jpg'>",
            nome: "gal costa"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos50/caymmi_violao_caymmi.jpg'>",
            nome: "dorival caymmi"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos50/chega_saudade_jgilberto.jpg'>",
            nome: "joão gilberto"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos60/som_baden_baden.jpg'>",
            nome: "baden powell"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/krig_ha_raul.jpg'>",
            nome: "raul seixas"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/tim_maia_tim.jpg'>",
            nome: "tim maia"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos90/sobrevivendo_no_inferno.jpg'>",
            nome: "racionais mc's"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos2000/ataque_lirico_cone.jpg'>",
            nome: "cone crew"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/a_voz_violao_djavan.jpg'>",
            nome: "djavan"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos70/secos_molhados_secos.jpg'>",
            nome: "secos e molhados"
        },
        {
            imagem: "<img src='../assets/imgs/albuns/anos2000/tribalistas_jasei.webp'>",
            nome: "tribalistas"
        }

    ]

    var aleatorio = 0

    function posicao(lista) {
        return parseInt(Math.random() * lista.length)
    }

    function sorteio() {
        aleatorio = posicao(listaImagens)
        divImagem.innerHTML = `${listaImagens[aleatorio].imagem}`
        inputNome.value = '';
    }

    var pontuacao = 0
    var tentativa = 0
    function verificar() {
        var idUsuario = Number(sessionStorage.ID_USUARIO);
        /*         var listaImagens.length = listaImagens.length
                var aleatorio = parseInt(Math.random() * listaImagens.length) */


        var nome = listaImagens[aleatorio].nome
        var iptNome = inputNome.value.toLowerCase()

        if (tentativa <= 9) {
            tentativa++
            if (nome == iptNome) {
                pontuacao += 10
                inputNome.value = '';
                Swal.fire({
                    icon: 'success',
                    title: 'Acertou!!!',
                    text: `Artista: ${listaImagens[aleatorio].nome.toUpperCase()}`,
                    footer: `Sua pontuação por enquanto: ${pontuacao} | Tentativas: ${tentativa}/10`
                })
                sorteio()

            } else {
                pontuacao -= 5
                inputNome.value = '';
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    footer: `Sua pontuação por enquanto: ${pontuacao} | Tentativas: ${tentativa}/10`,
                    text: `A resposta certa era ${listaImagens[aleatorio].nome.toUpperCase()}`
                })
                sorteio()
            }
            // if (pontuacao == 5) {
            //     Swal.fire({
            //         icon: 'success',
            //         title: 'VOCÊ É UM MONSTRO!!!',
            //         text: 'Você acabou de acertar 5 SEGUIDAS!!!',
            //     })
            // }
        } else {
            fetch("/usuarios/Pontuacao", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.j
                    idUsuarioServer: idUsuario,
                    pontosServer: pontuacao,
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    Swal.fire({
                    title: 'Suas tentativas acabaram!',
                    text: "Sua pontuação está sendo armazenada...",
                    icon: 'warning',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'Ok, entendi'
                    }).then((result) => {
                        setTimeout(function () {
                            window.location = "dashboard.html";
                        }, 1000);
                    })
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;
        }


    }



</script>